Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4

====== PCR-807.1 Incorporation in Comanche 67 ======

([[comanche-67-reconstruction|Return to main Comanche 67 reconstruction page.]])

We don't have a copy of PCR-807.1, "Add Present Time Option to P21". [[https://www.ibiblio.org/apollo/Documents/Memo-Stokes700422_text.pdf#page=2|This memo]] explains in passing what may be meant by the title:

	... the "present time" option available in many routines (i.e., input of zero time taken to mean current time). ...

There is also a matching PCR-807.2, incorporated into Luminary 102. So comparison of Luminary 99 and Luminary 116 source code may reveal implementation details that could be imported into Comanche. Moreover, we have the [[https://www.ibiblio.org/apollo/Documents/E-2456-2D.pdf#page=758|Colossus 2C revision of flowchart FC-2580 ("P21")]].

First consider the flowchart. At the top of sheet 3 in subroutine P21PROG1 there is a test of DSPTEM1 (the time just input from the DSKY); if it is zero, then goto P21PRTM on sheet 5, which loads the present time into MPAC. This looks pretty suspiciously like what the title of the PCR is calling for.

Now, diff'ing GROUND TRACKING DETERMINATION PROGRAM - P21 of Luminary 99 vs Luminary 116 and concentrating on P21PROG1 and P21PRTM, we find in fact that the //only// differences are:

* The features from the flowchart mentioned above; and
* DSPTEM1 is cleared to zero just prior to entering P21PROG1.

I'm not sure DSPTEM1 would need to be cleared separately, but I suppose it goes along with the other change.

Action: Conditionally assembled based on the preprocessor label Reconstruction807, import the Luminary 116 coded differences from Luminary 99 just mentioned into Comanche. Along the way, I found that the changes had been made, though a bit uncleanly, so I tidied them up. I also found several instances in which unrelated stuff (removal of unused constants) had been done in the name of Reconstruction807; I restored those constants.

To summarize, the fix has been made in code. Restoring those constants has now cleared memory bank 07.

