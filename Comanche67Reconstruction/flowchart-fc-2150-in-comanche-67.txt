Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4

====== Flowchart FC-2150 Incorporation in Comanche 67 ======

([[comanche-67-reconstruction|Return to the main Comanche 67 reconstruction page.]])

FC-2150 is a Colossus 2C flowchart, though unfortunately we don't know which sheets were changed from Colossus 2A to 2C, so there's little choice other than simply to compare each sheet of the flowchart to the reconstructed code.

==== Sheets 1-2 ====

Just text, no flowcharts.

==== Sheet 3 ====

Interrupt vector 4024, KEYRUPT1: Looks good.

==== Sheet 4 ====

KEYCOM: Looks good.

==== Sheet 5 ====

Interrupt vector 4034, UPRUPT: The flowchart indicates that BBANK is loaded with UPRPTBB BBCON UPRUPT, which is consistent with how the other interrupts all work, but in every version of AGC code (as far as I can see) the code actually uses UPRPTBB = KEYRPTBB (where KEYRPTBB BBCON KEYRUPT1). No other interrupt is treated like that by the code. I guess it's not actually a discrepancy, and I suppose it works because an UPRUPT is basically doing identical stuff to what a KEYRUPT is doing (i.e., entering keystrokes as if from a DSKY), so the code for UPRUPTs must mostly be shared with KEYRUPTs, and must therefore be in the same memory bank.

With that understanding, looks good.

==== Sheet 6 ====

UPRPT1: So ... just to remind myself about something which confuses me but which would be obvious to anyone who worked regularly with AGC code: The MP instruction is not exactly an integer multiply, but rather a multiplication of two fractional values in the range (-1, 1). While you can interpret the operands as integers, the end result isn't going to be OPERAND1\*OPERAND2, but rather OPERAND1\*OPERAND2 shifted right by 14 bits, with the MSW of the result in A and the LSW in L. So the code performs a multiplication by 01000 (which I would naively think of as a left shift by 9), whereas the code and flowchart comments speak of a right shift by 5. That's because a left shift of 9 followed by a right shift of 14 is a right shift of 5. (End of discussion of the confusing-to-me-but-obvious-to-expert topic.)

With that understanding, looks good.

==== Sheet 7 ====

Continuation of UPRPT1, UPTEST, TMFAIL2: Looks good.

==== Sheet 8 ====

UPOK, CLUPLOCK: Looks good.

==== Sheet 9 ====

ACCEPTUP: Looks good.

